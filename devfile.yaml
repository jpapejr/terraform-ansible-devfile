schemaVersion: 2.2.2
metadata:
  name: terraform-and-ansible
  displayName: Terraform and Ansible IaC Development
  description: "This workspace template provides everything needed to begin working on IaC projects using Terraform and Ansible."
  tags:
    - terraform
    - ansible
    - iac
  version: 1.0.0
components:
  - name: tools
    container:
      image: quay.io/jtpape_nfr/terraform-ansible:latest
      args: ['tail', '-f', '/dev/null']
      mountSources: true
      env:
        - name: ANSIBLE_CONFIG
          value: /tmp/.ansible.cfg  # Path for Ansible config file
      volumeMounts:
        - name: ansible-config
          path: /tmp/.ansible.cfg
  - name: ansible-config
    volume:
      size: 1Gi
commands:
  - id: install-prereqs
    exec:
      commandLine: dnf install -y terraform ansible openssh-client curl git
      workingDir: ${PROJECT_SOURCE}
      group:
        kind: build
        isDefault: true
      component: tools
  - id: terraform-init
    exec:
      component: tools
      commandLine: terraform init  # Command to initialize Terraform
      workingDir: ${PROJECT_SOURCE} # Executing in the project source directory
  - id: terraform-plan
    exec:
      component: tools
      commandLine: terraform plan  # Command to create Terraform plan
      workingDir: ${PROJECT_SOURCE} # Executing in the project source directory
  - id: terraform-apply
    exec:
      component: tools
      commandLine: terraform apply # Command to apply Terraform changes
      workingDir: ${PROJECT_SOURCE} # Executing in the project source directory
  - id: ansible-lint
    exec:
      component: tools
      commandLine: ansible-lint --version # Command to verify ansible-lint
      workingDir: ${PROJECT_SOURCE} # Executing in the project source directory
  - id: ansible-playbook-syntax-check
    exec:
      component: tools
      commandLine: ansible-playbook --syntax-check playbook.yml # Command to verify playbook syntax
      workingDir: ${PROJECT_SOURCE} # Executing in the project source directory
  - id: ansible-playbook-run
    exec:
      component: tools
      commandLine: ansible-playbook playbook.yml # Command to run the Ansible playbook
      workingDir: ${PROJECT_SOURCE} # Executing in the project source directory
  - id: ansible-version
    exec:
      component: tools
      commandLine: ansible --version # Command to check Ansible Version
      workingDir: ${PROJECT_SOURCE} # Executing in the project source directory
  
